
[{"content":"Hi, My name is Paul McCormack and this is the start of my website. It is built using Hugo with the Blowfish theme and is hosted on GitHub Pages.\nIt\u0026rsquo;s a bit sparse at the moment but I will be adding more content over time. Watch this space!\n","date":"23 January 2026","externalUrl":null,"permalink":"/about/","section":"How do you cloud?","summary":"","title":"About Me","type":"page"},{"content":"\rIntroduction\r#\rThis project is to develop a method for checking if Bicep templates in the repo have changed on the latest commit. If they have add them to the deployment. If they haven\u0026rsquo;t skip them. The ultimate goal is to reduce the run time for a deployment on a project that contains multiple sets of templates and parameter files that are unlikley to be changed and redeployed together after the initial deployment.\nThe problem I\u0026rsquo;m trying to solve\r#\rI wanted to do this to improve the pipeline config for a repository that is used to manage Azure Policy. That project consists of four seperate sets of Bicep templates each with a corresponding bicepparam file. Currently the pipeline is setup to trigger when a push is made to the main branch and will perform the checks and deployment for all the templates within the repo regardless of whether they were changed in the last commit or not. This is not a real problem for the resulting policy deployment stacks due to the idempotent natue of Bicep but it does mean each deployment takes an excessive amount of time. A more desirable configuration would be to have some method of detecting which of the Bicep templates or parameter files have changed and only perform the actions required for that template.\nTo test the pipeline operation in this repo I am deploying an Azure Storage Account and a Vnet as test resources that don\u0026rsquo;t incur cost and can be easily redeployed to change configuration.\nThe solution - git diff to the rescue!\r#\rThe solution I have developed uses the git diff command to look for the changed files in the last commit, then in the pipeline jobs I have used a PowerShell switch statement to perform an action if the name of the bicep or bicepparram file is found within the output from the git diff command.\nThe code below shows this:\nWrite-Output \u0026#34;Checking for changed Bicep and parameter files in the last commit...\u0026#34; $changed = git diff HEAD HEAD~1 --name-only | Select-String -Pattern \u0026#39;.bicep\u0026#39; if ($null -ne $changed) { Write-Output \u0026#34;The following Bicep or parameter files have changed in the last commit:\u0026#34; $changed foreach ($item in $changed) { switch ($item) { \u0026#39;stg.bicep\u0026#39; { New-AzResourceGroupDeployment -Location ${{ env.location }} -ResourceGroupName ${{ env.rgName }} -TemplateFile ./stg.bicep -TemplateParameterFile ./stg.bicepparam -Verbose } \u0026#39;stg.bicepparam\u0026#39; { New-AzResourceGroupDeployment -Location ${{ env.location }} -ResourceGroupName ${{ env.rgName }} -TemplateFile ./stg.bicep -TemplateParameterFile ./stg.bicepparam -Verbose } \u0026#39;vnet.bicep\u0026#39; { New-AzResourceGroupDeployment -Location ${{ env.location }} -ResourceGroupName ${{ env.rgName }} -TemplateFile ./vnet.bicep -TemplateParameterFile ./vnet.bicepparam -Verbose } \u0026#39;vnet.bicepparam\u0026#39; { New-AzResourceGroupDeployment -Location ${{ env.location }} -ResourceGroupName ${{ env.rgName }} -TemplateFile ./vnet.bicep -TemplateParameterFile ./vnet.bicepparam -Verbose } } } } else { Write-Output \u0026#34;No Bicep or parameter files have been changed in the last commit.\u0026#34; }\rIf the storage account related files appear in the list of changed files from git diff the command to deploy the storage account template will be run. If the vnet related file names appear the command to deploy the vnet will be run. If a file from both the storage account and the vnet files was changed in the last commit both templates will be deployed.\nTo make this work your actions runner needs to have the repo checked out. This is very easy to do with the checkout action but I was having problems which suggested the git history wasn\u0026rsquo;t being included in that checkout. I found the answer was to include the fetch-depth option in the checkout step. You can control how much history is checked out with this statement also. Including fetch-depth: 0 will bring the entire history. This might take a bit of time for a very large repo. In theory we only need the most recent commit and the one previous to that. The statement fetch-depth 1 should give you that.\nIn the pipeline config file it looks like this:\n- name: Checkout repository uses: actions/checkout@v5 with: fetch-depth: 0 # Fetch all history for all branches and tags\rThe pipeline config file is deploy.yml\nTesting the deployment\r#\rFor the first test I want to get both resources deployed. This proves the pipeline will be able to detect changes to multiple templates or parameter files and act accordingly. Creating a change in both parameter files and pushing that to the main branch results in the pipeline running, from the logs we can see the results are exactly as we expect. Both the storage account and the vnet have been picked up as changed and are being deployed.\nChecking for changed Bicep and parameter files in the last commit... The following Bicep or parameter files have changed in the last commit: stg.bicepparam vnet.bicepparam VERBOSE: Using Bicep v0.37.4 VERBOSE: Calling Bicep with arguments: build-params \u0026#34;/home/runner/work/deploy-changed-bicep-templates/deploy-changed-bicep-templates/stg.bicepparam\u0026#34; --stdout VERBOSE: Performing the operation \u0026#34;Creating Deployment\u0026#34; on target \u0026#34;rg-uks-sandbox-pmc\u0026#34;. VERBOSE: 16:19:11 - Template is valid. VERBOSE: 16:19:42 - Resource Microsoft.Storage/storageAccounts \u0026#39;stguumu27r4tuhry\u0026#39; provisioning status is succeeded . VERBOSE: Using Bicep v0.37.4 VERBOSE: Calling Bicep with arguments: build-params \u0026#34;/home/runner/work/deploy-changed-bicep-templates/deploy-changed-bicep-templates/vnet.bicepparam\u0026#34; --stdout VERBOSE: Performing the operation \u0026#34;Creating Deployment\u0026#34; on target \u0026#34;rg-uks-sandbox-pmc\u0026#34;. VERBOSE: 16:20:01 - Template is valid. VERBOSE: 16:20:15 - Resource Microsoft.Network/virtualNetworks \u0026#39;vnet-pmc-test\u0026#39; provisioning status is succeeded VERBOSE: 16:20:32 - Resource Microsoft.Network/virtualNetworks/subnets \u0026#39;vnet-pmc-test/subnet1\u0026#39; provisioning status is succeeded\rFor the second test I need to make a change to one of the resources and ensure the deployment only picks that template to run. To do that I will disable public network access on the storage account and commit the change to the repo. Again from the logs this is working as expected. Only the storage account parameter files was picked up and deployed.\nChecking for changed Bicep and parameter files in the last commit... The following Bicep or parameter files have changed in the last commit: stg.bicepparam VERBOSE: Using Bicep v0.37.4 VERBOSE: Calling Bicep with arguments: build \u0026#34;/home/runner/work/deploy-changed-bicep-templates/deploy-changed-bicep-templates/stg.bicep\u0026#34; --stdout VERBOSE: Performing the operation \u0026#34;Creating Deployment\u0026#34; on target \u0026#34;rg-uks-sandbox-pmc\u0026#34;. VERBOSE: 16:49:57 - Template is valid. VERBOSE: 16:50:03 - Resource Microsoft.Storage/storageAccounts \u0026#39;stguumu27r4tuhry\u0026#39; provisioning status is succeeded\rThe final test is to make a commit that doesn\u0026rsquo;t include the bicep templates or parameter files. Again from the logs it performed exactly as required. No Bicep deployments were made.\nChecking for changed Bicep and parameter files in the last commit... No Bicep or parameter files have been changed in the last commit. Script execution Complete\rConclusion\r#\rAfter implementing these changes to the pipeline configuration in my Azure Policy repository, run times dropped from an average 9 minutes down to 3 minutes when a change was made to a single bicep template or parameter file. Resulting in a much more efficient config and potentially preventing the need to increase resources and cost by requiring the purchase of concurrent runners for the environment.\nðŸ¦¾\n","date":"23 January 2026","externalUrl":null,"permalink":"/posts/deploychangedbiceptemplateghactions/","section":"Posts","summary":"","title":"Deploy Changed Bicep Templates with GitHub Actions","type":"posts"},{"content":"","date":"23 January 2026","externalUrl":null,"permalink":"/","section":"How do you cloud?","summary":"","title":"How do you cloud?","type":"page"},{"content":"","date":"23 January 2026","externalUrl":null,"permalink":"/hugoandblowfish/","section":"HugoAndBlowfish","summary":"","title":"HugoAndBlowfish","type":"hugoandblowfish"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"},{"content":"","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"}]